<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,minimum-scale=0.5,user-scalable=yes"/>
  <title>LEDBrain Setup</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <h1>LEDBrain</h1>
    </div>
    <div class="top-actions">
      <label class="top-slider" for="brightnessGlobal">
        <span id="lblGlobalBrightness" class="muted">Brightness</span>
        <div class="slider-shell">
          <input id="brightnessGlobal" type="range" min="1" max="255" value="255">
          <span id="brightnessValue">100%</span>
        </div>
      </label>
      <div class="network-status" id="networkStatus" data-type="ethernet">
        <svg class="network-icon network-ethernet" viewBox="0 0 24 24">
          <rect x="2" y="8" width="18" height="8" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
          <path d="M6 10h12M6 14h12" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
          <path d="M1 12h3M20 12h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          <circle cx="1" cy="12" r="1.5" fill="currentColor"/>
          <circle cx="23" cy="12" r="1.5" fill="currentColor"/>
        </svg>
        <svg class="network-icon network-wifi" viewBox="0 0 24 24">
          <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.07 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/>
        </svg>
        <div class="wifi-signal-bars" data-strength="0">
          <svg viewBox="0 0 24 24" class="network-icon">
            <rect class="bar-1" x="2" y="18" width="4" height="4" rx="1"/>
            <rect class="bar-2" x="8" y="14" width="4" height="8" rx="1"/>
            <rect class="bar-3" x="14" y="10" width="4" height="12" rx="1"/>
          </svg>
        </div>
      </div>
      <div class="network-traffic" id="networkTraffic">
        <div class="traffic-item">
          <svg class="traffic-icon traffic-up" viewBox="0 0 24 24">
            <path d="M7 14l5-5 5 5z"/>
          </svg>
          <span class="traffic-value" id="trafficTx">0 KB/s</span>
        </div>
        <div class="traffic-item">
          <svg class="traffic-icon traffic-down" viewBox="0 0 24 24">
            <path d="M7 10l5 5 5-5z"/>
          </svg>
          <span class="traffic-value" id="trafficRx">0 KB/s</span>
        </div>
      </div>
      <div class="temperature-indicator" id="temperatureIndicator" data-temp="0">
        <svg class="temperature-icon" viewBox="0 0 24 24">
          <path d="M15 13V5c0-1.66-1.34-3-3-3S9 3.34 9 5v8c-1.21.91-2 2.37-2 4 0 2.76 2.24 5 5 5s5-2.24 5-5c0-1.63-.79-3.09-2-4zm-4-8c0-.55.45-1 1-1s1 .45 1 1h-1v1h1v2h-1v1h1v2h-2V5z"/>
        </svg>
        <span class="temperature-value" id="temperatureValue">--°C</span>
      </div>
      <div class="cpu-usage-indicator" id="cpuUsageIndicator">
        <svg class="cpu-icon" viewBox="0 0 24 24">
          <rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
          <path d="M8 8h8v8H8z" fill="none" stroke="currentColor" stroke-width="1.5"/>
          <path d="M10 6v2M14 6v2M10 16v2M14 16v2M6 10h2M6 14h2M16 10h2M16 14h2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <div class="cpu-cores">
          <div class="cpu-core">
            <span class="cpu-core-label">C0</span>
            <span class="cpu-core-value" id="cpuCore0Value">--%</span>
          </div>
          <div class="cpu-core">
            <span class="cpu-core-label">C1</span>
            <span class="cpu-core-value" id="cpuCore1Value">--%</span>
          </div>
        </div>
      </div>
      <button id="btnToggleAll" class="primary subtle icon-only" data-state="stopped" title="" aria-label="Start/Stop All">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5"/>
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c1.54 0 2.98-.33 4.24-.91L12 12V2z" fill="currentColor" opacity="0.5"/>
          <path d="M8 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
        </svg>
      </button>
      <button id="btnToggleEffects" class="primary subtle icon-only" data-state="stopped" title="" aria-label="Start/Stop Effects">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"/>
        </svg>
      </button>
      <button id="btnToggleAudio" class="primary subtle icon-only" data-state="stopped" title="" aria-label="Start/Stop Audio">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
      </button>
      <button id="btnRefresh" class="primary subtle icon-only" aria-label="Refresh" title="Refresh / Long press to reboot" data-action="refresh">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M21 5v6h-6" />
          <path d="M3 19v-6h6" />
          <path d="M5 10a7 7 0 0 1 11.66-3.79L21 9" />
          <path d="M19 14a7 7 0 0 1-11.66 3.8L3 15" />
        </svg>
      </button>
      <div class="chip" id="chipIp">IP: --</div>
    </div>
  </header>

  <div id="statusBar" class="status hidden"></div>

  <div class="layout">
    <aside class="sidebar">
      <div class="lang-switcher">
        <label id="lblLang" for="langSwitch">Language</label>
        <select id="langSwitch">
          <option value="pl">Polski</option>
          <option value="en">English</option>
        </select>
      </div>
      <nav>
        <button data-tab="overview" id="navOverview" class="active">Lights</button>
        <button data-tab="led" id="navLed">Devices</button>
        <button data-tab="network" id="navNetwork">Network</button>
        <button data-tab="mqtt" id="navMqtt">MQTT</button>
        <button data-tab="system" id="navSystem">System</button>
      </nav>
    </aside>

    <main class="content">
      <section id="overview" class="view active">
        <header>
          <h2 id="overviewTitle">Devices</h2>
          <p id="overviewSubtitle" class="muted">Click a device to configure effects.</p>
        </header>
        <div class="device-actions-bar" style="margin-bottom: 1.5rem; display: flex; gap: 0.5rem; align-items: center;">
          <button id="btnDeviceRescan" class="ghost small">Rescan</button>
          <button id="btnDeviceAdd" class="ghost small">Add WLED</button>
          <div style="flex: 1;"></div>
          <label class="switch compact">
            <input type="checkbox" id="previewEnabled" checked>
            <span></span>
          </label>
          <span class="muted" style="font-size: 0.8rem;">Live preview</span>
        </div>
        <div class="preview-devices-grid" id="previewDevicesGrid">
          <div class="preview-empty">
            <p class="muted">No devices configured</p>
            <p class="small muted">Add devices or segments to see live preview</p>
          </div>
        </div>
        
        <!-- Inline effect configuration panel (shown when device is selected) -->
        <div id="inlineEffectPanel" class="inline-effect-panel" style="display: none;">
        </div>
        
        <div class="cards">
          <article class="card">
            <header>
              <h3 id="statusCardTitle">Runtime</h3>
              <span class="badge" id="badgeStatus">-</span>
            </header>
            <dl class="kv">
              <div><dt id="lblDevice">Device name</dt><dd id="valDevice">-</dd></div>
              <div><dt id="lblFirmware">Firmware</dt><dd id="valFirmware">-</dd></div>
              <div><dt id="lblOta">OTA</dt><dd id="valOta">-</dd></div>
              <div><dt id="lblUptime">Uptime</dt><dd id="valUptime">-</dd></div>
            </dl>
          </article>

          <article class="card">
            <header>
              <h3 id="networkCardTitle">Network</h3>
              <span class="badge" id="badgeNetwork">—</span>
            </header>
            <dl class="kv">
              <div><dt id="lblIp">IP address</dt><dd id="valIp">—</dd></div>
              <div><dt id="lblGateway">Gateway</dt><dd id="valGateway">—</dd></div>
              <div><dt id="lblDns">DNS</dt><dd id="valDns">—</dd></div>
            </dl>
          </article>

          <article class="card">
            <header>
              <h3 id="mqttCardTitle">MQTT bridge</h3>
              <span class="badge" id="badgeMqtt">—</span>
            </header>
            <dl class="kv">
              <div><dt id="lblMqttServer">Server</dt><dd id="valMqttServer">—</dd></div>
              <div><dt id="lblMqttUser">User</dt><dd id="valMqttUser">—</dd></div>
              <div><dt id="lblDdp">DDP target</dt><dd id="valDdp">—</dd></div>
            </dl>
            <div class="card-actions">
              <button id="btnOpenHA" class="ghost">Open Home Assistant</button>
              <button id="btnMqttTest" class="ghost">Test publish</button>
            </div>
          </article>
        </div>
      </section>

      <section id="led" class="view">
        <header>
          <h2 id="ledTitle">LED engine</h2>
          <p id="ledSubtitle" class="muted">Hardware layout, audio binding and effect sources.</p>
        </header>
        <div class="subnav" id="ledSubnav">
          <button data-target="config-power-pane" id="tabConfigPower" class="active">Power</button>
          <button data-target="config-segments-pane" id="tabConfigSegments">Segments</button>
          <button data-target="config-audio-pane" id="tabConfigAudio">Audio</button>
          <button data-target="config-virtual-pane" id="tabConfigVirtual">Virtual segments</button>
          <button data-target="config-wled-pane" id="tabConfigWled">WLED</button>
        </div>

        <div class="led-pane active" id="config-power-pane">
          <article class="card form-card slim">
            <header>
              <h3 id="ledDriverTitle">Driver &amp; power budget</h3>
              <p id="ledDriverSubtitle" class="muted">Tune frame rate and keep the PSU within limits.</p>
            </header>
            <div class="form-grid slim">
              <label for="ledDriver" id="lblDriver">Driver</label>
              <select id="ledDriver">
                <option value="esp_rmt">ESP RMT</option>
                <option value="neopixelbus">NeoPixelBus</option>
                <option value="external">External</option>
              </select>
              <label for="maxFps" id="lblMaxFps">Target FPS</label>
              <input id="maxFps" type="number" min="1" max="240">
              <label for="psuVoltage" id="lblPsuVoltage">PSU voltage (V)</label>
              <input id="psuVoltage" type="number" min="2" max="48" step="0.1">
              <label for="psuWatts" id="lblPsuWatts">PSU power (W)</label>
              <input id="psuWatts" type="number" min="0" max="500" step="1">
              <label id="lblAutoPowerLimit">Auto current from PSU</label>
              <label class="switch compact">
                <input type="checkbox" id="autoPowerLimit">
                <span></span>
              </label>
              <label for="currentLimit" id="lblCurrentLimit">Current limit (mA)</label>
              <input id="currentLimit" type="number" min="0" max="20000">
              <label for="parallelOutputs" id="lblParallelOutputs">Parallel outputs</label>
              <input id="parallelOutputs" type="number" min="1" max="8">
              <label id="lblEnableDma">DMA acceleration</label>
              <label class="switch compact">
                <input type="checkbox" id="enableDma">
                <span></span>
              </label>
            </div>
            <p class="form-hint" id="psuHint">Feed LEDs directly from the PSU and share ground with the controller.</p>
            <p class="power-summary" id="powerSummary"></p>
          </article>
        </div>

        <div class="led-pane" id="config-segments-pane">
          <article class="card">
            <header class="card-header">
              <div>
                <h3 id="ledSegmentsTitle">Physical segments</h3>
                <p class="muted" id="segmentHint">Match each strip with the same order as in WLED.</p>
              </div>
              <button id="btnAddSegment" class="ghost small">Add segment</button>
            </header>
            <div class="table-wrapper">
              <table class="segments-table">
                <thead>
                  <tr>
                    <th id="colSegName">Name</th>
                    <th id="colSegLeds">LEDs</th>
                    <th id="colSegStart">Start</th>
                    <th id="colSegOrder">Render order</th>
                    <th id="colSegPin">Pin</th>
                    <th id="colSegChipset">Chipset</th>
                    <th id="colSegColorOrder">Color order</th>
                    <th id="colSegRmt">RMT</th>
                    <th id="colSegMatrix">Matrix</th>
                    <th id="colSegPower">Power (mA)</th>
                    <th id="colSegSource">Effect source</th>
                    <th id="colSegDirection">Reverse</th>
                    <th id="colSegMirror">Mirror</th>
                    <th id="colSegEnabled">Enabled</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="segmentTableBody">
                  <tr class="placeholder">
                    <td colspan="12" id="ledSegmentsEmpty">No segments yet</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p class="form-hint" id="ledPowerHint">Pins deliver only data. Power strips from the PSU and use common ground.</p>
          </article>
          
          <article class="card" id="segmentDeviceDetailCard" style="display: none;">
            <header class="card-header">
              <div>
                <h3 id="segmentDeviceDetailTitle">Segment Effect Configuration</h3>
                <p class="muted" id="segmentDeviceDetailSubtitle">Configure effect engine, effect, and parameters.</p>
              </div>
            </header>
            <div id="segmentDeviceDetailBody"></div>
          </article>
        </div>

        <div class="led-pane" id="config-virtual-pane">
          <article class="card">
            <header class="card-header">
              <div>
                <h3 id="effectsTitle">Virtual segments / groups</h3>
                <p class="muted" id="effectsSubtitle">Combine multiple physical segments and WLED devices into unified groups. One effect will be rendered and distributed to all members.</p>
              </div>
              <button id="btnAddVirtual" class="ghost small">Add virtual segment</button>
            </header>
            <div id="virtualList" class="virtual-list"></div>
          </article>
          
          <article class="card" id="virtualDeviceDetailCard" style="display: none;">
            <header class="card-header">
              <div>
                <h3 id="virtualDeviceDetailTitle">Virtual Segment Effect Configuration</h3>
                <p class="muted" id="virtualDeviceDetailSubtitle">Configure effect engine, effect, and parameters.</p>
              </div>
            </header>
            <div id="virtualDeviceDetailBody"></div>
          </article>
        </div>

        <div class="led-pane" id="config-audio-pane">
          <article class="card form-card slim">
            <header>
              <h3 id="audioTitle">Audio input</h3>
              <p id="audioSubtitle" class="muted">Snapcast or local capture with per-channel sensitivity.</p>
            </header>
            <div class="form-grid slim">
              <label for="audioSource" id="lblAudioSource">Source</label>
              <select id="audioSource">
                <option value="none">None</option>
                <option value="snapcast">Snapcast</option>
                <option value="line_in">Line-in</option>
              </select>
              <label for="audioSampleRate" id="lblAudioSampleRate">Sample rate</label>
              <input id="audioSampleRate" type="number" min="8000" max="96000" step="1000">
              <label for="audioFft" id="lblAudioFft">FFT size</label>
              <input id="audioFft" type="number" min="64" max="4096" step="64">
              <label for="audioFrame" id="lblAudioFrame">Frame (ms)</label>
              <input id="audioFrame" type="number" min="5" max="100">
              <label for="audioSensitivity" id="lblAudioSensitivity">Sensitivity</label>
              <input id="audioSensitivity" type="number" min="0.1" max="5" step="0.1">
              <label for="audioStereo" id="lblAudioStereo">Stereo</label>
              <label class="switch compact">
                <input type="checkbox" id="audioStereo">
                <span></span>
              </label>
            </div>
            <div class="form-hint" id="audioHint">Audio frames from Snapcast keep LED beats in sync with the room.</div>
          </article>

          <article class="card form-card slim">
            <header>
              <h3 id="snapcastTitle">Snapcast link</h3>
              <p id="snapcastSubtitle" class="muted">Configure transport for remote audio capture.</p>
            </header>
            <div class="form-grid slim">
              <label for="snapHost" id="lblSnapHost">Snapcast host</label>
              <input id="snapHost" placeholder="snapcast.local">
              <label for="snapPort" id="lblSnapPort">Snapcast port</label>
              <input id="snapPort" type="number" min="1" max="65535">
              <label for="snapLatency" id="lblSnapLatency">Latency (ms)</label>
              <input id="snapLatency" type="number" min="0" max="500">
              <label for="snapUdp" id="lblSnapUdp">Prefer UDP</label>
              <label class="switch compact">
                <input type="checkbox" id="snapUdp">
                <span></span>
              </label>
            </div>
            <div class="form-hint" id="snapHint">UDP reduces latency but needs stable network.</div>
            <div class="form-actions end">
              <button type="button" class="primary" id="btnSaveAudio">Save audio config</button>
            </div>
          </article>
        </div>

        <div class="led-pane" id="config-wled-pane">
          <article class="card">
            <header class="card-header">
              <div>
                <h3 id="wledTitle">WLED layout</h3>
                <p id="wledSubtitle" class="muted">Detected controllers and LED counts.</p>
              </div>
              <button id="btnWledRescan" class="ghost">Rescan</button>
            </header>
            <div class="table-wrapper">
              <table class="wled-table">
                <thead>
                  <tr>
                    <th id="wledTableName">Name</th>
                    <th id="wledTableId">Identifier</th>
                    <th id="wledTableLeds">LEDs</th>
                    <th id="wledTableSegments">Segments</th>
                    <th id="wledTableStatus">Status</th>
                    <th id="wledTableLastSeen">Last seen</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="wledTableBody"></tbody>
              </table>
            </div>
          </article>

          <article class="card form-card slim">
            <header>
              <h3 id="wledManualTitle">Add WLED manually</h3>
              <p id="wledManualSubtitle" class="muted">Provide controller address when discovery fails.</p>
            </header>
            <div class="form-grid slim">
              <label for="wledManualName" id="wledManualNameLabel">Name</label>
              <input id="wledManualName" placeholder="Desk strip">
              <label for="wledManualAddress" id="wledManualAddressLabel">Host / IP</label>
              <input id="wledManualAddress" placeholder="192.168.0.42">
              <label for="wledManualLeds" id="wledManualLedsLabel">LEDs</label>
              <input id="wledManualLeds" type="number" min="1" max="4096">
              <label for="wledManualSegments" id="wledManualSegmentsLabel">Segments</label>
              <input id="wledManualSegments" type="number" min="1" max="64" value="1">
            </div>
            <div class="form-actions end">
              <button type="button" class="primary" id="btnWledAdd">Add controller</button>
            </div>
          </article>
          
          <article class="card" id="wledDeviceDetailCard" style="display: none;">
            <header class="card-header">
              <div>
                <h3 id="wledDeviceDetailTitle">Device Effect Configuration</h3>
                <p class="muted" id="wledDeviceDetailSubtitle">Configure effect engine, effect, and parameters.</p>
              </div>
            </header>
            <div id="wledDeviceDetailBody"></div>
          </article>
        </div>
      </section>

      <section id="network" class="view">
        <header>
          <h2 id="networkTitle">Network configuration</h2>
          <p id="networkSubtitle" class="muted">Use DHCP or set manual parameters.</p>
        </header>
        <div class="panel-grid">
          <article class="card form-card">
            <header class="card-header">
              <div>
                <h3 id="networkAddressingTitle">Addressing</h3>
                <p class="muted" id="networkAddressingSubtitle">DHCP or static parameters used after reboot.</p>
              </div>
              <div class="inline-switch">
                <span id="dhcpLabel">Network mode</span>
                <label class="switch">
                  <input type="checkbox" id="dhcp">
                  <span></span>
                </label>
              </div>
            </header>
            <div class="form-grid">
              <label for="ip" id="lblStaticIp">Static IP</label><input id="ip" placeholder="192.168.1.80">
              <label for="mask" id="lblNetmask">Netmask</label><input id="mask" placeholder="255.255.255.0">
              <label for="gw" id="lblGatewayForm">Gateway</label><input id="gw" placeholder="192.168.1.1">
              <label for="dns" id="lblDnsForm">DNS</label><input id="dns" placeholder="8.8.8.8">
            </div>
            <div class="form-hint" id="networkHint">Saving without reboot keeps current link until manual restart.</div>
          </article>

          <article class="card form-card slim">
            <header class="card-header">
              <div>
                <h3 id="networkIdentityTitle">Identity & apply</h3>
                <p class="muted" id="networkIdentitySubtitle">Hostname and when to write settings.</p>
              </div>
            </header>
            <div class="form-grid slim">
              <label for="host" id="lblHost">Hostname</label><input id="host" placeholder="ledbrain">
            </div>
            <div class="form-actions">
              <button type="button" class="primary" id="btnSaveNetwork">Save & reboot</button>
              <button type="button" class="ghost" id="btnNetworkApply">Save only</button>
            </div>
          </article>

          <article class="card form-card">
            <header class="card-header">
              <div>
                <h3 id="wifiTitle">WiFi Configuration</h3>
                <p class="muted" id="wifiSubtitle">Connect to WiFi network when Ethernet is unavailable.</p>
              </div>
              <button type="button" class="ghost small" id="btnWifiScan">Scan</button>
            </header>
            <div id="wifiStatus" class="form-hint" style="margin-bottom: 1rem;"></div>
            <div class="form-grid">
              <label for="wifiSsid" id="lblWifiSsid" style="grid-column: span 2;">Network (SSID)
                <select id="wifiSsid" style="margin-top: 0.5rem;">
                  <option value="">Select network...</option>
                </select>
              </label>
              <label for="wifiPassword" id="lblWifiPassword" style="grid-column: span 2;">Password
                <input type="password" id="wifiPassword" placeholder="WiFi password">
              </label>
            </div>
            <div class="form-actions">
              <button type="button" class="primary" id="btnWifiConnect">Connect</button>
            </div>
            <div id="wifiNetworksList" style="margin-top: 1rem; display: none;">
              <h4 style="margin-bottom: 0.5rem;" id="wifiNetworksTitle">Available networks:</h4>
              <div id="wifiNetworks" style="display: flex; flex-direction: column; gap: 0.5rem;"></div>
            </div>
          </article>
        </div>
      </section>

      <section id="mqtt" class="view">
        <header>
          <h2 id="mqttTitle">MQTT configuration</h2>
          <p id="mqttSubtitle" class="muted">Connect with Home Assistant or other brokers.</p>
        </header>
        <div class="panel-grid">
          <article class="card form-card">
            <header class="card-header">
              <div>
                <h3 id="mqttBrokerTitle">Broker</h3>
                <p class="muted" id="mqttBrokerSubtitle">Enable the bridge and point it at your broker.</p>
              </div>
              <div class="inline-switch">
                <span id="mqttEnabledLabel">Enable MQTT</span>
                <label class="switch">
                  <input type="checkbox" id="mqttEnabled">
                  <span></span>
                </label>
              </div>
            </header>
            <div class="form-grid">
              <label for="mqttHost" id="lblMqttHost">Server</label><input id="mqttHost" placeholder="homeassistant.local">
              <label for="mqttPort" id="lblMqttPort">Port</label><input id="mqttPort" type="number" min="1" max="65535" value="1883">
              <label for="mqttUser" id="lblMqttUserField">Username</label><input id="mqttUser">
              <label for="mqttPass" id="lblMqttPass">Password</label><input id="mqttPass" type="password">
            </div>
            <div class="form-hint" id="mqttHint">Broker credentials are optional. DDP target is your WLED instance.</div>
          </article>

          <article class="card form-card slim">
            <header class="card-header">
              <div>
                <h3 id="mqttDdpTitle">DDP target</h3>
                <p class="muted" id="mqttDdpSubtitle">Where to send site-to-site effects.</p>
              </div>
            </header>
            <div class="form-grid slim">
              <label for="ddpTarget" id="lblDdpTarget">DDP target</label><input id="ddpTarget" placeholder="wled-desk.local">
              <label for="ddpPort" id="lblDdpPort">DDP port</label><input id="ddpPort" type="number" min="1" max="65535" value="4048">
            </div>
            <div class="form-actions">
              <button type="button" class="primary" id="btnSaveMqtt">Save & reboot</button>
              <button type="button" class="ghost" id="btnMqttSync">Sync topics</button>
              <button type="button" class="ghost" id="btnMqttTest">Test connection</button>
            </div>
          </article>
        </div>
      </section>

      <section id="system" class="view">
        <header>
          <h2 id="systemTitle">System</h2>
          <p id="systemSubtitle" class="muted">General behaviour and maintenance tools.</p>
        </header>
        <article class="card">
          <header>
            <h3 id="systemInfoTitle">System info</h3>
            <p class="muted" id="systemInfoSubtitle">Current firmware and platform details.</p>
          </header>
          <dl class="kv">
            <div><dt id="lblSystemFw">Firmware</dt><dd id="valSystemFw">-</dd></div>
            <div><dt id="lblSystemIdf">ESP-IDF</dt><dd id="valSystemIdf">-</dd></div>
            <div><dt id="lblSystemBuild">Build time</dt><dd id="valSystemBuild">-</dd></div>
          </dl>
        </article>

        <article class="card form-card slim">
          <header>
            <h3 id="otaTitle">OTA updates</h3>
            <p class="muted" id="otaSubtitle">Check and install releases after confirmation.</p>
          </header>
          <div class="form-grid slim">
            <label id="lblCurrentVersion">Current version</label>
            <div class="pill" id="valCurrentVersion">-</div>
            <label id="lblAvailableVersion">Latest available</label>
            <div class="pill ghost" id="valAvailableVersion">-</div>
          </div>
          <div class="form-actions">
            <button type="button" class="ghost" id="btnOtaCheck">Check for updates</button>
            <button type="button" class="primary" id="btnOtaApply" disabled>Install update</button>
          </div>
          <div class="form-hint" id="otaHint">Pulls the latest firmware from GitHub releases.</div>
          <div class="form-hint" id="otaStatus">OTA idle</div>
          <hr style="margin: 1.5rem 0;">
          <h4 style="margin-top: 0;">Upload firmware file</h4>
          <div class="form-grid">
            <label>
              <input type="file" id="otaFileInput" accept=".bin" style="display: none;">
              <button type="button" class="ghost" id="btnOtaSelectFile">Select firmware file</button>
              <span id="otaFileName" class="muted" style="display: block; margin-top: 0.5rem;">No file selected</span>
            </label>
            <button type="button" class="primary" id="btnOtaUpload" disabled>Upload and install</button>
          </div>
          <div class="form-hint" id="otaUploadHint">Select a .bin file to upload and install firmware directly.</div>
          <div id="otaUploadProgress" style="display: none; margin-top: 1rem;">
            <div class="progress-bar">
              <div class="progress-fill" id="otaProgressFill" style="width: 0%;"></div>
            </div>
            <div class="muted" id="otaProgressText" style="margin-top: 0.5rem;">0%</div>
          </div>
        </article>

        <div class="card form-card">
          <div class="form-grid slim">
            <label for="langMirror" id="lblLangSystem">Language</label>
            <select id="langMirror">
              <option value="pl">Polski</option>
              <option value="en">English</option>
            </select>
            <label for="autostart" id="lblAutostart">Autostart effects</label>
            <label class="switch">
              <input type="checkbox" id="autostart">
              <span></span>
            </label>
          </div>
          <div class="form-hint" id="systemHint">Autostart wiring will be connected with runtime soon.</div>
          <div class="form-actions">
            <button type="button" class="primary" id="btnSaveSystem">Save</button>
            <button type="button" class="danger" id="btnFactoryReset">Factory reset</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <datalist id="effectCatalog"></datalist>
  <script src="/app.js"></script>
</body>
</html>
